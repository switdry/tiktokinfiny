<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alerta de Regalos - TikTok Live</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: transparent;
            color: #fff;
            overflow: hidden;
        }
        
        .gift-alert-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
            pointer-events: none;
        }
        
        .gift-alert {
            background: linear-gradient(135deg, rgba(255, 0, 80, 0.95) 0%, rgba(255, 20, 147, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px 48px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 60px rgba(255, 0, 80, 0.5), 0 0 40px rgba(255, 20, 147, 0.3);
            min-width: 400px;
            text-align: center;
            opacity: 0;
            transform: scale(0.5) translateY(50px);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .gift-alert.show {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
        
        .gift-alert-icon {
            font-size: 4em;
            margin-bottom: 16px;
            animation: bounce 1s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        .gift-alert-user {
            font-size: 1.6em;
            font-weight: 800;
            color: white;
            margin-bottom: 8px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .gift-alert-name {
            font-size: 1.2em;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 12px;
        }
        
        .gift-alert-diamonds {
            font-size: 1.4em;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
    </style>
</head>
<body>
    <div class="gift-alert-container" id="giftAlertContainer"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const username = urlParams.get('user') || window.location.pathname.split('/').pop();
        const minDiamonds = parseInt(urlParams.get('minDiamonds') || '50');
        const apiUrl = window.location.origin;
        
        function getGiftEmoji(giftName) {
            if (!giftName) return 'ğŸ';
            const name = giftName.toLowerCase();
            if (name.includes('rosa') || name.includes('rose')) return 'ğŸŒ¹';
            if (name.includes('panda')) return 'ğŸ¼';
            if (name.includes('perfume')) return 'ğŸ’„';
            if (name.includes('amor') || name.includes('love')) return 'ğŸ’•';
            if (name.includes('confeti') || name.includes('confetti')) return 'ğŸŠ';
            if (name.includes('gafas') || name.includes('sunglasses')) return 'ğŸ•¶ï¸';
            if (name.includes('dinero') || name.includes('money')) return 'ğŸ’¸';
            if (name.includes('disco')) return 'ğŸª©';
            if (name.includes('sirena') || name.includes('mermaid')) return 'ğŸ§œâ€â™€ï¸';
            if (name.includes('aviÃ³n') || name.includes('airplane')) return 'âœˆï¸';
            if (name.includes('planeta') || name.includes('planet')) return 'ğŸª';
            if (name.includes('diamante') || name.includes('diamond')) return 'ğŸ’';
            if (name.includes('leÃ³n') || name.includes('lion')) return 'ğŸ¦';
            if (name.includes('universe')) return 'ğŸŒŒ';
            if (name.includes('corona') || name.includes('crown')) return 'ğŸ‘‘';
            if (name.includes('fuego') || name.includes('fire')) return 'ğŸ”¥';
            if (name.includes('estrella') || name.includes('star')) return 'â­';
            if (name.includes('cake') || name.includes('pastel')) return 'ğŸ‚';
            if (name.includes('corazÃ³n') || name.includes('heart')) return 'â¤ï¸';
            return 'ğŸ';
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showGiftAlert(gift) {
            const totalDiamonds = (gift.diamondCount || 0) * (gift.repeatCount || 1);
            
            // Solo mostrar si supera el mÃ­nimo
            if (totalDiamonds < minDiamonds) {
                return;
            }
            
            const container = document.getElementById('giftAlertContainer');
            const emoji = getGiftEmoji(gift.giftName);
            
            const alertDiv = document.createElement('div');
            alertDiv.className = 'gift-alert';
            alertDiv.innerHTML = `
                <div class="gift-alert-icon">${emoji}</div>
                <div class="gift-alert-user">@${escapeHtml(gift.user || 'Usuario')}</div>
                <div class="gift-alert-name">${escapeHtml(gift.giftName || 'Regalo')} x${gift.repeatCount || 1}</div>
                <div class="gift-alert-diamonds">ğŸ’ ${totalDiamonds.toLocaleString()}</div>
            `;
            
            container.appendChild(alertDiv);
            
            // Mostrar con animaciÃ³n
            setTimeout(() => {
                alertDiv.classList.add('show');
            }, 10);
            
            // Ocultar despuÃ©s de 5 segundos
            setTimeout(() => {
                alertDiv.classList.remove('show');
                setTimeout(() => {
                    alertDiv.remove();
                }, 500);
            }, 5000);
        }
        
        function connectSSE() {
            if (!username) {
                return;
            }

            const eventSource = new EventSource(`${apiUrl}/api/tiktok/events/${username}`);
            
            eventSource.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    if (data.type === 'gift') {
                        showGiftAlert(data.data);
                    }
                } catch (e) {
                    console.error('Error parsing event:', e);
                }
            };

            eventSource.onerror = () => {
                eventSource.close();
                setTimeout(connectSSE, 3000);
            };
        }
        
        connectSSE();
    </script>
</body>
</html>

